qlf_entrez <-as.data.table( merge(toplist,entrez_IDs, by = 'gene_name'))
library(ribor)
library(tidyverse)
library(edgeR)
library(data.table)
library(ggpubr)
library(stack)
original.ribo <- Ribo("/Users/yashshukla/Documents/Computational/Celegans_riboITP/data/celegans_duplicate_allstages.ribo")
reseq.ribo <- Ribo("/Users/yashshukla/Documents/Computational/Celegans_riboITP/data/20230929_WT_ITP_reseq1/output_umi/ribo/all.ribo")
ribo_one_two_cell<- get_region_counts(original.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('1cell_A','1cell_B','2cell_B'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
# the two-cell A data is slightly biases towards higher sized reads
ribo_two_cell_A <-  get_region_counts(original.ribo,
range.lower = 28,
range.upper = 38,
experiment = c('2cell_A'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_two_cell_C<-  get_region_counts(reseq.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('2-cell_C'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_one_two_cell<- as.data.table(ribo_one_two_cell)
ribo_two_cell_A <-as.data.table(ribo_two_cell_A)
ribo_two_cell_C <-as.data.table(ribo_two_cell_C)
ribo_one_two_cell [,CDS := (CDS+1)]
ribo_two_cell_A [,CDS := (CDS+1)]
ribo_two_cell_C [,CDS := (CDS+1)]
rcw_diff_one_two = dcast(ribo_one_two_cell, transcript ~ experiment)
rcw_diff_two_A = dcast(ribo_two_cell_A, transcript ~ experiment)
rcw_diff_two_C = dcast(ribo_two_cell_C, transcript ~ experiment)
rcw_diff = inner_join(rcw_diff_one_two,rcw_diff_two_A, by = "transcript")
rcw_diff_ribo = inner_join(rcw_diff,rcw_diff_two_C , by = "transcript")
#processing RNA-seq
rnaseq_diff <- get_rnaseq(ribo.object = original.ribo,
tidy        = F,
compact = F,
experiment = c('1cell_A','1cell_B','2cell_A','2cell_B'),
region = "CDS")
rnaseq_diff <- as.data.table(rnaseq_diff)
rnaseq_w_diff = dcast(rnaseq_diff, transcript ~ experiment)
all_counts_diff = merge(rnaseq_w_diff, rcw_diff_ribo, by= "transcript")
all_counts_diff <- all_counts_diff[, transcript := as.character(transcript)]
all_counts_diff[, gene_name := sapply(strsplit(transcript, "gene_symbol:"), function(x) tail(x, n = 1))]
all_counts_diff [,"transcript":= NULL ]
all_counts_diff <- setcolorder(all_counts_diff, "gene_name")
colnames(all_counts_diff)<-c("gene_name","
1-cell_A.RNA",
"1-cell_B.RNA",
"2-cell_A.RNA",
"2-cell_B.RNA",
"1-cell_A.RIBO",
"1-cell_B.RIBO",
"2-cell_A.RIBO",
"2-cell_B.RIBO",
"2-cell_C.RIBO")
exptype <- factor(c("onecell.RNA","onecell.RNA",
"twocell.RNA","twocell.RNA",
"onecell.Ribo","onecell.Ribo","twocell.Ribo",
"twocell.Ribo","twocell.Ribo" )  )
y <- DGEList(counts=all_counts_diff[,-1],
group=exptype, genes = all_counts_diff[,1])
keep <- filterByExpr(y,min.total.count = 15 )
y <- y[keep,,keep.lib.sizes=FALSE]
y <- calcNormFactors(y, method = "TMM")
design <- model.matrix(~0+exptype)
colnames(design) <- levels(exptype)
y <- estimateDisp(y,design)
fit <- glmQLFit(y,design)
my.contrasts <- makeContrasts(
TE_onecellvstwocell = (twocell.Ribo - twocell.RNA) - (onecell.Ribo - onecell.RNA) ,
Ribo_onevstwo =  twocell.Ribo - onecell.Ribo  ,
RNA_onevstwo = twocell.RNA - onecell.RNA ,
levels = design
)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_onevstwo"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribo_onevstwo"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_onecellvstwocell"])
ensembl <- useEnsembl(biomart = "genes", dataset = "celegans_gene_ensembl")
library(biomaRt)
ensembl <- useEnsembl(biomart = "genes", dataset = "celegans_gene_ensembl")
listFilters(ensembl)
listofgenes<- qlf$genes
entrez_IDs <- getBM(attributes = c('entrezgene_id','wormbase_gene','external_gene_name'),
filters = 'external_gene_name',
values = listofgenes ,
mart = ensembl)
colnames(entrez_IDs) <- c('entrezgene_id','wormbase_gene','gene_name')
entrez_IDs
qlf_entrez <- merge(qlf,entrez_IDs, by = 'gene_name')
head(qlf_entrez)
toplist <- topTags(qlf,p.value = 0.015, n = Inf)
qlf_entrez <-as.data.table( merge(toplist,entrez_IDs, by = 'gene_name'))
View(qlf_entrez)
#export list of up and down regulated genes
toplist<-as.data.table(topTags(qlf, n =Inf))
all_genes <- all_counts_diff[`1cell_A.x` > 0 | `1cell_B.x`> 0|`2cell_A.x` > 0 | `2cell_B.x`> 0,]
all_genes <- all_counts_diff[`1cell_A.x` > 0 | `1cell_B.x`> 0|`2cell_A.x` > 0 | `2cell_B.x`> 0,]
View(all_counts_diff)
all_genes <- all_counts_diff[`1-cell_A.RNA` > 0 | `1-cell_A.RNA`> 0|`2-cell_A.RNA` > 0 | `2-cell_B.RNA`> 0,]
down_signal <- toplist[table.logFC < (-1.5) & table.FDR <0.05,]
up_signal <- toplist[table.logFC > 1.5 & table.FDR < 0.05]
#export list of up and down regulated genes
toplist<-as.data.table(topTags(qlf, n =Inf))
all_counts_diff <- all_counts_diff[, transcript := as.character(transcript)]
all_counts_diff[, gene_name := sapply(strsplit(transcript, "gene_symbol:"), function(x) tail(x, n = 1))]
all_counts_diff <- all_counts_diff[, transcript := as.character(transcript)]
#processing RNA-seq
rnaseq_diff <- get_rnaseq(ribo.object = original.ribo,
tidy        = F,
compact = F,
experiment = c('1cell_A','1cell_B','2cell_A','2cell_B'),
region = "CDS")
rnaseq_diff <- as.data.table(rnaseq_diff)
rnaseq_w_diff = dcast(rnaseq_diff, transcript ~ experiment)
all_counts_diff = merge(rnaseq_w_diff, rcw_diff_ribo, by= "transcript")
all_counts_diff <- all_counts_diff[, transcript := as.character(transcript)]
all_counts_diff[, gene_name := sapply(strsplit(transcript, "gene_symbol:"), function(x) tail(x, n = 1))]
all_counts_diff [,"transcript":= NULL ]
all_counts_diff <- setcolorder(all_counts_diff, "gene_name")
colnames(all_counts_diff)<-c("gene_name",
"1-cell_A.RNA",
"1-cell_B.RNA",
"2-cell_A.RNA",
"2-cell_B.RNA",
"1-cell_A.RIBO",
"1-cell_B.RIBO",
"2-cell_A.RIBO",
"2-cell_B.RIBO",
"2-cell_C.RIBO")
colnames(all_counts_diff)
#export list of up and down regulated genes
toplist<-as.data.table(topTags(qlf, n =Inf))
all_genes <- all_counts_diff[`1-cell_A.RNA` > 0 | `1-cell_B.RNA`> 0|`2-cell_A.RNA` > 0 | `2-cell_B.RNA`> 0,]
down_signal <- toplist[table.logFC < (-1.5) & table.FDR <0.05,]
up_signal <- toplist[table.logFC > 1.5 & table.FDR < 0.05]
View(all_genes)
View(up_signal)
# Replotting length distrubution after using the two 3-embryo data as replicates. (Sanity Check)
plot_length_distribution(x           = original.ribo,
region      = "CDS",
experiment = c("1cell_A","1cell_B","2cell_B","4cell_A","4cell_B","8cell_A"),
range.lower = 20,
range.upper = 40,
fraction    = TRUE)
library(ribor)
library(tidyverse)
library(data.table)
original.ribo <- Ribo("/Users/yashshukla/Documents/Computational/Celegans_riboITP/data/20230929_WT_ITP_reseq1/output_umi/ribo/all.ribo")
plot_length_distribution(x           = original.ribo,
region      = "CDS",
range.lower = 22,
range.upper = 40,
fraction    = FALSE)
plot_length_distribution(x           = original.ribo,
region      = "CDS",
range.lower = 22,
range.upper = 40,
fraction    = TRUE)
View(up_signal)
View(all_genes)
View(down_signal)
