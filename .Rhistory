qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribofourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_fourcellvsonecell"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribofourvsone"])
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_fourcellvsonecell"])
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
rm(list=ls())
library(ribor)
library(tidyverse)
library(edgeR)
library(data.table)
color.palette0 = colorRampPalette(c("#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"), space="Lab")
new.ribo <- Ribo("/Users/yashshukla/Documents/Computational/Celegans_riboITP/data/20230720_additional_replicates/celegans.ribo")
original.ribo <- Ribo("data/celegans_duplicate_allstages.ribo")
ribo_cell_or<- get_region_counts(original.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('1cell_A', '1cell_B','8cell_A'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_new <-  get_region_counts(new.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('8cell_D'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_or<- as.data.table(ribo_cell_or)
ribo_cell_or [,CDS := (CDS+1)]
ribo_cell_new <-as.data.table(ribo_cell_new)
ribo_cell_new [,CDS := (CDS+1)]
rcw_diff_or = dcast(ribo_cell_or, transcript ~ experiment)
rcw_diff_new = dcast(ribo_cell_new , transcript ~ experiment)
rcw_diff_ribo = merge.data.table(rcw_diff_or,rcw_diff_new,by='transcript')
colnames(rcw_diff_ribo)
setcolorder(rcw_diff_ribo, c("transcript", "1cell_A",    "1cell_B"  ,"8cell_A","8cell_B"  ,  "8cell_D"   ))
setcolorder(rcw_diff_ribo, c("transcript", "1cell_A",    "1cell_B"  ,"8cell_A", ,  "8cell_D"   ))
setcolorder(rcw_diff_ribo, c("transcript", "1cell_A",    "1cell_B"  ,"8cell_A",  "8cell_D"   ))
colnames(rcw_diff_ribo)<- c("transcript", "1cell_A_ribo",    "1cell_B_ribo" ,"8cell_A_ribo",  "8cell_D_ribo")
#processing RNA-seq
rnaseq_diff <- get_rnaseq(ribo.object = original.ribo,
tidy        = F,
compact = F,
experiment = c('1cell_A','1cell_B','8cell_A','8cell_B'),
region = "CDS")
rnaseq_diff <- as.data.table(rnaseq_diff)
rnaseq_diff [,CDS := (CDS+1)]
rnaseq_w_diff = dcast(rnaseq_diff, transcript ~ experiment)
all_counts_diff = merge(rcw_diff_ribo,rnaseq_w_diff, by= "transcript")
exptype <- factor(c( "onecell.Ribo",
"onecell.Ribo",
"eightcell.Ribo",
"eightcell.Ribo",
"onecell.RNA",
"onecell.RNA",
"eightcell.RNA",
"eightcell.RNA")  )
y <- DGEList(counts=all_counts_diff[,-1],
group=exptype, genes = all_counts_diff[,1])
keep <- filterByExpr(y)
y <- y[keep,,keep.lib.sizes=FALSE]
y <- calcNormFactors(y, method = "TMM")
design <- model.matrix(~0+exptype)
colnames(design) <- levels(exptype)
y <- estimateDisp(y,design)
plotBCV(y)
plotMDS(y)
fit <- glmQLFit(y,design)
my.contrasts <- makeContrasts(
TE_eightcellvsonecell = (eightcell.Ribo - eightcell.RNA) - (onecell.Ribo - onecell.RNA) ,
Riboeightvsone =  eightcell.Ribo - onecell.Ribo  ,
RNA_eightvsone = eightcell.RNA - onecell.RNA ,
levels = design
)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_eightvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Riboeightvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_eightcellvsonecell"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
top <-topTags(qlf, n = Inf)
head (qlf$genes)
view(top)
top <-topTags(qlf)
view(top)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_eightvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Riboeightvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_eightcellvsonecell"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_eightvsone"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Riboeightvsone"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
plotBCV(y)
plotMDS(y)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_eightvsone"])
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Riboeightvsone"])
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_eightcellvsonecell"])
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
top <-topTags(qlf)
view(top)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribofourvsone"])
top <-topTags(qlf)
view(top)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_eightvsone"])
top <-topTags(qlf)
view(top)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribofourvsone"])
top <-topTags(qlf)
view(top)
rm(list=ls())
library(ribor)
library(tidyverse)
library(edgeR)
library(data.table)
color.palette0 = colorRampPalette(c("#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"), space="Lab")
new.ribo <- Ribo("/Users/yashshukla/Documents/Computational/Celegans_riboITP/data/20230720_additional_replicates/celegans.ribo")
original.ribo <- Ribo("data/celegans_duplicate_allstages.ribo")
ribo_cell_or<- get_region_counts(original.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('1cell_A', '1cell_B','4cell_B'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_new <-  get_region_counts(new.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('4cell_C','4cell_D'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_or<- as.data.table(ribo_cell_or)
ribo_cell_or [,CDS := (CDS+1)]
ribo_cell_new <-as.data.table(ribo_cell_new)
ribo_cell_new [,CDS := (CDS+1)]
rcw_diff_or = dcast(ribo_cell_or, transcript ~ experiment)
rcw_diff_new = dcast(ribo_cell_new , transcript ~ experiment)
rcw_diff_ribo = merge.data.table(rcw_diff_or,rcw_diff_new,by='transcript')
colnames(rcw_diff_ribo)
setcolorder(rcw_diff_ribo, c("transcript", "1cell_A",    "1cell_B"  ,"4cell_B","4cell_C"  ,  "4cell_D"   ))
colnames(rcw_diff_ribo)<- c("transcript", "1cell_A_ribo",    "1cell_B_ribo" ,"4cell_B_ribo","4cell_C_ribo"  ,  "4cell_D_ribo")
#processing RNA-seq
rnaseq_diff <- get_rnaseq(ribo.object = original.ribo,
tidy        = F,
compact = F,
experiment = c('1cell_A','1cell_B','4cell_A','4cell_B'),
region = "CDS")
rnaseq_diff <- as.data.table(rnaseq_diff)
rnaseq_diff [,CDS := (CDS+1)]
rnaseq_w_diff = dcast(rnaseq_diff, transcript ~ experiment)
all_counts_diff = merge(rcw_diff_ribo,rnaseq_w_diff, by= "transcript")
exptype <- factor(c( "onecell.Ribo",
"onecell.Ribo",
"fourcell.Ribo",
"fourcell.Ribo",
"fourcell.Ribo",
"onecell.RNA",
"onecell.RNA",
"fourcell.RNA",
"fourcell.RNA")  )
y <- DGEList(counts=all_counts_diff[,-1],
group=exptype, genes = all_counts_diff[,1])
keep <- filterByExpr(y)
y <- y[keep,,keep.lib.sizes=FALSE]
y <- calcNormFactors(y, method = "TMM")
design <- model.matrix(~0+exptype)
colnames(design) <- levels(exptype)
y <- estimateDisp(y,design)
plotBCV(y)
plotMDS(y)
fit <- glmQLFit(y,design)
my.contrasts <- makeContrasts(
TE_fourcellvsonecell = (fourcell.Ribo - fourcell.RNA) - (onecell.Ribo - onecell.RNA) ,
Ribofourvsone =  fourcell.Ribo - onecell.Ribo  ,
RNA_fourvsone = fourcell.RNA - onecell.RNA ,
levels = design
)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribofourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_fourcellvsonecell"])
summary(decideTests(qlf, p.value = 0.05, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.05, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
top <-topTags(qlf)
summary(decideTests(qlf, p.value = 0.001, adjust.method = "fdr"))
top <-topTags(qlf)
view(top)
top <-topTags(qlf,n = Inf)
view(top)
plotMD(qlf, p.value = 0.001, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
top <-topTags(qlf,n = Inf)
head (qlf$genes)
view(top)
ensembl <- useEnsembl(biomart = "genes", dataset = "celegans_gene_ensembl")
listFilters(ensembl)
listofgenes<- qlf$genes
entrez_IDs <- getBM(attributes = c('entrezgene_id','wormbase_gene','external_gene_name'),
filters = 'external_gene_name',
values = listofgenes ,
mart = ensembl)
colnames(entrez_IDs) <- c('entrezgene_id','wormbase_gene','gene_name')
entrez_IDs
rm(list=ls())
library(ribor)
library(tidyverse)
library(edgeR)
library(data.table)
library(ggpubr)
library(stack)
library(EnhancedVolcano)
library(biomaRt)
color.palette0 = colorRampPalette(c("#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"), space="Lab")
original.ribo <- Ribo("data/celegans_duplicate_allstages.ribo")
original.ribo
ribo_one_two_cell<- get_region_counts(original.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('1cell_A','1cell_B','2cell_B'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_two_cell_A <-  get_region_counts(original.ribo,
range.lower = 28,
range.upper = 38,
experiment = c('2cell_A'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_one_two_cell<- as.data.table(ribo_one_two_cell)
ribo_two_cell_A <-as.data.table(ribo_two_cell_A)
ribo_one_two_cell [,CDS := (CDS+1)]
ribo_two_cell_A [,CDS := (CDS+1)]
rcw_diff_one_two = dcast(ribo_one_two_cell, transcript ~ experiment)
rcw_diff_two_A = dcast(ribo_two_cell_A, transcript ~ experiment)
rcw_diff_ribo = inner_join(rcw_diff_one_two,rcw_diff_two_A, by = "transcript")
#processing RNA-seq
rnaseq_diff <- get_rnaseq(ribo.object = original.ribo,
tidy        = F,
compact = F,
experiment = c('1cell_A','1cell_B','2cell_A','2cell_B'),
region = "CDS")
rnaseq_diff <- as.data.table(rnaseq_diff)
rnaseq_w_diff = dcast(rnaseq_diff, transcript ~ experiment)
all_counts_diff = merge(rnaseq_w_diff, rcw_diff_ribo, by= "transcript")
# Extract the gene name using strsplit and data.table
all_counts_diff <- all_counts_diff[, transcript := as.character(transcript)]
all_counts_diff[, gene_name := sapply(strsplit(transcript, "gene_symbol:"), function(x) tail(x, n = 1))]
all_counts_diff [,"transcript":= NULL ]
all_counts_diff <- setcolorder(all_counts_diff, "gene_name")
exptype <- factor(c("onecell.RNA","onecell.RNA",
"twocell.RNA","twocell.RNA",
"onecell.Ribo","onecell.Ribo","twocell.Ribo",
"twocell.Ribo" )  )
y <- DGEList(counts=all_counts_diff[,-1],
group=exptype, genes = all_counts_diff[,1])
keep <- filterByExpr(y)
y <- y[keep,,keep.lib.sizes=FALSE]
y <- calcNormFactors(y, method = "TMM")
design <- model.matrix(~0+exptype)
colnames(design) <- levels(exptype)
y <- estimateDisp(y,design)
plotBCV(y)
plotMDS(y)
fit <- glmQLFit(y,design)
my.contrasts <- makeContrasts(
TE_onecellvstwocell = (twocell.Ribo - twocell.RNA) - (onecell.Ribo - onecell.RNA) ,
Ribo_onevstwo =  twocell.Ribo - onecell.Ribo  ,
RNA_onevstwo = twocell.RNA - onecell.RNA ,
levels = design
)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_onevstwo"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribo_onevstwo"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_onecellvstwocell"])
#assessing p-value distribution
out <- topTags(qlf, n = "Inf")$table
ggplot(out, aes(x = PValue)) +
geom_histogram(bins = 70)
check <- topTags(qlf)
ensembl <- useEnsembl(biomart = "genes", dataset = "celegans_gene_ensembl")
qlf
rm(list=ls())
library(ribor)
library(tidyverse)
library(edgeR)
library(data.table)
color.palette0 = colorRampPalette(c("#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"), space="Lab")
new.ribo <- Ribo("/Users/yashshukla/Documents/Computational/Celegans_riboITP/data/20230720_additional_replicates/celegans.ribo")
original.ribo <- Ribo("data/celegans_duplicate_allstages.ribo")
ribo_cell_or<- get_region_counts(original.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('1cell_A', '1cell_B','4cell_B'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_new <-  get_region_counts(new.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('4cell_C','4cell_D'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_or<- as.data.table(ribo_cell_or)
ribo_cell_or [,CDS := (CDS+1)]
ribo_cell_new <-as.data.table(ribo_cell_new)
ribo_cell_new [,CDS := (CDS+1)]
rcw_diff_or = dcast(ribo_cell_or, transcript ~ experiment)
rcw_diff_new = dcast(ribo_cell_new , transcript ~ experiment)
rcw_diff_ribo = merge.data.table(rcw_diff_or,rcw_diff_new,by='transcript')
colnames(rcw_diff_ribo)
setcolorder(rcw_diff_ribo, c("transcript", "1cell_A",    "1cell_B"  ,"4cell_B","4cell_C"  ,  "4cell_D"   ))
colnames(rcw_diff_ribo)<- c("transcript", "1cell_A_ribo",    "1cell_B_ribo" ,"4cell_B_ribo","4cell_C_ribo"  ,  "4cell_D_ribo")
#processing RNA-seq
rnaseq_diff <- get_rnaseq(ribo.object = original.ribo,
tidy        = F,
compact = F,
experiment = c('1cell_A','1cell_B','4cell_A','4cell_B'),
region = "CDS")
rnaseq_diff <- as.data.table(rnaseq_diff)
rnaseq_diff [,CDS := (CDS+1)]
rnaseq_w_diff = dcast(rnaseq_diff, transcript ~ experiment)
all_counts_diff = merge(rcw_diff_ribo,rnaseq_w_diff, by= "transcript")
exptype <- factor(c( "onecell.Ribo",
"onecell.Ribo",
"fourcell.Ribo",
"fourcell.Ribo",
"fourcell.Ribo",
"onecell.RNA",
"onecell.RNA",
"fourcell.RNA",
"fourcell.RNA")  )
y <- DGEList(counts=all_counts_diff[,-1],
group=exptype, genes = all_counts_diff[,1])
keep <- filterByExpr(y)
y <- y[keep,,keep.lib.sizes=FALSE]
y <- calcNormFactors(y, method = "TMM")
design <- model.matrix(~0+exptype)
colnames(design) <- levels(exptype)
y <- estimateDisp(y,design)
plotBCV(y)
plotMDS(y)
fit <- glmQLFit(y,design)
my.contrasts <- makeContrasts(
TE_fourcellvsonecell = (fourcell.Ribo - fourcell.RNA) - (onecell.Ribo - onecell.RNA) ,
Ribofourvsone =  fourcell.Ribo - onecell.Ribo  ,
RNA_fourvsone = fourcell.RNA - onecell.RNA ,
levels = design
)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribofourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_fourcellvsonecell"])
summary(decideTests(qlf, p.value = 0.001, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.001, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
top <-topTags(qlf,n = Inf)
head (qlf$genes)
view(top)
ensembl <- useEnsembl(biomart = "genes", dataset = "celegans_gene_ensembl")
listFilters(ensembl)
listofgenes<- qlf$genes
entrez_IDs <- getBM(attributes = c('entrezgene_id','wormbase_gene','external_gene_name'),
filters = 'external_gene_name',
values = listofgenes ,
mart = ensembl)
qlf
library(ribor)
library(tidyverse)
library(edgeR)
library(data.table)
color.palette0 = colorRampPalette(c("#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"), space="Lab")
new.ribo <- Ribo("/Users/yashshukla/Documents/Computational/Celegans_riboITP/data/20230720_additional_replicates/celegans.ribo")
original.ribo <- Ribo("data/celegans_duplicate_allstages.ribo")
ribo_cell_or<- get_region_counts(original.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('1cell_A', '1cell_B','4cell_B'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_new <-  get_region_counts(new.ribo,
range.lower = 25,
range.upper = 35,
experiment = c('4cell_C','4cell_D'),
length      = TRUE,
transcript  = FALSE,
tidy = F,
region      = c("CDS") )
ribo_cell_or<- as.data.table(ribo_cell_or)
ribo_cell_or [,CDS := (CDS+1)]
ribo_cell_new <-as.data.table(ribo_cell_new)
ribo_cell_new [,CDS := (CDS+1)]
rcw_diff_or = dcast(ribo_cell_or, transcript ~ experiment)
rcw_diff_new = dcast(ribo_cell_new , transcript ~ experiment)
rcw_diff_ribo = merge.data.table(rcw_diff_or,rcw_diff_new,by='transcript')
colnames(rcw_diff_ribo)
setcolorder(rcw_diff_ribo, c("transcript", "1cell_A",    "1cell_B"  ,"4cell_B","4cell_C"  ,  "4cell_D"   ))
colnames(rcw_diff_ribo)<- c("transcript", "1cell_A_ribo",    "1cell_B_ribo" ,"4cell_B_ribo","4cell_C_ribo"  ,  "4cell_D_ribo")
#processing RNA-seq
rnaseq_diff <- get_rnaseq(ribo.object = original.ribo,
tidy        = F,
compact = F,
experiment = c('1cell_A','1cell_B','4cell_A','4cell_B'),
region = "CDS")
rnaseq_diff <- as.data.table(rnaseq_diff)
rnaseq_diff [,CDS := (CDS+1)]
rnaseq_w_diff = dcast(rnaseq_diff, transcript ~ experiment)
all_counts_diff = merge(rcw_diff_ribo,rnaseq_w_diff, by= "transcript")
all_counts_diff <- all_counts_diff[, transcript := as.character(transcript)]
all_counts_diff[, gene_name := sapply(strsplit(transcript, "gene_symbol:"), function(x) tail(x, n = 1))]
all_counts_diff [,"transcript":= NULL ]
all_counts_diff <- setcolorder(all_counts_diff, "gene_name")
exptype <- factor(c( "onecell.Ribo",
"onecell.Ribo",
"fourcell.Ribo",
"fourcell.Ribo",
"fourcell.Ribo",
"onecell.RNA",
"onecell.RNA",
"fourcell.RNA",
"fourcell.RNA")  )
y <- DGEList(counts=all_counts_diff[,-1],
group=exptype, genes = all_counts_diff[,1])
keep <- filterByExpr(y)
y <- y[keep,,keep.lib.sizes=FALSE]
y <- calcNormFactors(y, method = "TMM")
design <- model.matrix(~0+exptype)
colnames(design) <- levels(exptype)
y <- estimateDisp(y,design)
plotBCV(y)
plotMDS(y)
fit <- glmQLFit(y,design)
my.contrasts <- makeContrasts(
TE_fourcellvsonecell = (fourcell.Ribo - fourcell.RNA) - (onecell.Ribo - onecell.RNA) ,
Ribofourvsone =  fourcell.Ribo - onecell.Ribo  ,
RNA_fourvsone = fourcell.RNA - onecell.RNA ,
levels = design
)
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"RNA_fourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"Ribofourvsone"])
qlf <- glmQLFTest(fit, contrast=my.contrasts[,"TE_fourcellvsonecell"])
summary(decideTests(qlf, p.value = 0.001, adjust.method = "fdr"))
plotMD(qlf, p.value = 0.001, hl.cex = 0.75, main = "",
hl.col = color.palette0(2), legend = F)
top <-topTags(qlf,n = Inf)
head (qlf$genes)
ensembl <- useEnsembl(biomart = "genes", dataset = "celegans_gene_ensembl")
listFilters(ensembl)
listofgenes<- qlf$genes
entrez_IDs <- getBM(attributes = c('entrezgene_id','wormbase_gene','external_gene_name'),
filters = 'external_gene_name',
values = listofgenes ,
mart = ensembl)
colnames(entrez_IDs) <- c('entrezgene_id','wormbase_gene','gene_name')
entrez_IDs
qlf_entrez <-as.data.table( merge(toplist,entrez_IDs, by = 'gene_name'))
qlf_entrez <- merge(qlf,entrez_IDs, by = 'gene_name')
head(qlf_entrez)
toplist <- topTags(qlf,p.value = 0.015, n = Inf)
qlf_entrez <-as.data.table( merge(toplist,entrez_IDs, by = 'gene_name'))
qlf_entrez_up <- qlf_entrez[logFC>0]
qlf_entrez_down <- qlf_entrez[logFC<0]
# now onto go_annotation
genelist <- qlf_entrez$entrezgene_id
GO <-goana(genelist, species = "Ce")
view(topGO(GO, n = Inf, p.value = 0.05))
qlf_entrez_up <- qlf_entrez[logFC>0]
genelist <- qlf_entrez_up$entrezgene_id
GO <-goana(genelist, species = "Ce")
view(topGO(GO, n = Inf, p.value = 0.05))
qlf_entrez_down <- qlf_entrez[logFC<0]
genelist <- qlf_entrez_down$entrezgene_id
GO <-goana(genelist, species = "Ce")
view(topGO(GO, n = Inf, p.value = 0.05))
